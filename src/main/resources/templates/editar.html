<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="es">
<head>
    <meta charset="UTF-8">
    <title th:text="${personal.nombre}">Editar Personal</title>

    <!-- CSS / JS globales -->
    <th:block th:replace="~{fragments/css :: import-css}" />
    <th:block th:replace="~{fragments/js :: import-js}" />

    <!-- Bootstrap Icons (si no vienen en el fragmento) -->
    <link rel="stylesheet" th:href="@{/webjars/bootstrap-icons/1.10.5/font/bootstrap-icons.css}"/>

    <!-- Estilos y script de impresión -->
    <link rel="stylesheet" type="text/css" th:href="@{/print.min.css}"/>
    <script th:src="@{/print.min.js}"></script>

    <!-- JS propio -->
    <script th:src="@{/editar.js}"></script>

    <style>
        /* Fondo general de la página */
        body {
	        min-height: 100vh;
	        margin: 0;
	
	        /* ✅ Usa Thymeleaf para respetar el context-path */
	        background: url([[@{/images/Fondos__02.png}]]) no-repeat center center fixed;
	        background-size: cover;
	
	        display: flex;
	        align-items: center;
	        justify-content: center;
	        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
	    }

        /* Capa con blur suave */
        .page-wrapper {
            min-height: 100vh;
            padding: 1.5rem 0 2.5rem 0;
            backdrop-filter: blur(3px);
        }

        /* Card principal */
        .card-editar {
            background: rgba(255, 255, 255, 0.88);
            border-radius: 1rem;
            box-shadow: 0 18px 45px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .card-editar .card-header {
            border-bottom: 1px solid rgba(148, 163, 184, 0.35);
        }

        .title-icon {
            width: 42px;
            height: 42px;
            border-radius: 999px;
            background: rgba(13, 110, 253, 0.1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: .75rem;
        }

        .title-icon i {
            color: #0d6efd;
            font-size: 1.25rem;
        }

        .badge-estado {
            font-size: .75rem;
        }
    </style>
</head>
<body>

<div class="page-wrapper">
    <div class="container-lg">

        <!-- Menú -->
        <th:block th:replace="~{fragments/menu :: import-menu}" sec:authorize="isAuthenticated()"/>

        <!-- Card principal -->
        <div class="card card-editar mt-3">
            <div class="card-header bg-transparent py-3">
                <div class="d-flex flex-wrap justify-content-between align-items-center gap-2">

                    <!-- Título -->
                    <div class="d-flex align-items-center">
                        <div class="title-icon">
                            <i class="bi bi-person-badge-fill"></i>
                        </div>
                        <div>
                            <h5 class="mb-0">
                                Editar personal
                                <span class="text-primary" th:text="${personal.nombre}">Nombre</span>
                            </h5>
                            <small class="text-muted">
                                Modifique los datos necesarios y guarde los cambios.
                            </small>
                        </div>
                    </div>

                    <!-- Info pequeña (opcional) -->
                    <div class="text-end">
                        <div class="badge bg-light text-secondary border badge-estado">
                            Código:
                            <span th:text="${personal.codigo}">0000</span>
                        </div>
                    </div>

                </div>
            </div>

            <div class="card-body">
                <div class="row">
                    <!-- Columna principal del formulario -->
                    <div class="col-lg-7 col-md-8">

                        <form>

                            <!-- Nombre -->
                            <div class="mb-3">
                                <label class="form-label">* Nombre</label>
                                <input type="text"
                                       class="form-control"
                                       id="lbl_nombre"
                                       th:value="${personal.nombre}"
                                       placeholder="Nombre completo">
                            </div>

                            <!-- Nacional / Extranjero -->
                            <div class="row">
                                <!-- Nacional -->
                                <div class="col-md-12 col-xl-6 mb-3">
                                    <label class="form-label mb-1">Nacional</label>
                                    <div class="input-group">
                                        <div class="input-group-text">
                                            <input class="form-check-input"
                                                   type="radio"
                                                   name="options"
                                                   value="nacional"
                                                   th:checked="${personal.extranjero ? false : true}">
                                        </div>
                                        <span class="input-group-text">RUT</span>
                                        <input type="text"
                                               class="form-control"
                                               id="lbl_rut_nacional"
                                               placeholder="números, sin dígito verificador"
                                               th:value="${personal.extranjero ? '' : personal.rut}">
                                        <span class="input-group-text"
                                              id="lbl_rut_nacional_dv"
                                              th:text="${personal.extranjero ? 'N.A.' : '- '+personal.digitoVerificador}">
                                            -
                                        </span>
                                    </div>
                                </div>

                                <!-- Extranjero -->
								<div class="col-md-12 col-xl-6 mb-3">
								    <label class="form-label mb-1">Extranjero</label>
								    <div class="input-group">
								
								        <!-- Radio extranjero -->
								        <div class="input-group-text">
								            <input class="form-check-input"
								                   type="radio"
								                   name="options"
								                   value="extranjero"
								                   th:checked="${personal.extranjero}">
								        </div>
								
								        <!-- Etiqueta “Pasaporte” -->
								        <span class="input-group-text">Pasaporte</span>
								
								        <!-- Prefijo EXT fijo -->
								        <span class="input-group-text">EXT</span>
								
								        <!-- El input sigue recibiendo TODO el rut desde backend -->
								        <input type="text"
								               class="form-control"
								               id="lbl_pass_extranjero"
								               placeholder="Alfanumérico"
								               th:value="${personal.extranjero ? personal.rut : ''}">
								    </div>
								</div>

                            </div>

                            <!-- Observaciones -->
                            <div class="mb-3">
                                <label class="form-label">Observaciones</label>
                                <textarea class="form-control"
                                          id="lbl_observaciones"
                                          rows="3"
                                          placeholder="Notas adicionales, comentarios, etc."
                                          th:text="${personal.observaciones}"></textarea>
                            </div>

                        </form>
                    </div>

                    <!-- Columna lateral (opcional para info, acciones, impresión) -->
                    <div class="col-lg-5 col-md-4 mt-3 mt-md-0">
                        <div class="border rounded-3 p-3 bg-light-subtle h-100">
                            <h6 class="mb-2">
                                <i class="bi bi-info-circle me-1 text-secondary"></i>
                                Resumen
                            </h6>
                            <p class="small text-muted mb-2">
                                Revise que los datos de identificación sean coherentes con la documentación presentada.
                            </p>

                            <ul class="list-unstyled small mb-0">
                                <li class="mb-1">
                                    <i class="bi bi-check-circle-fill text-success me-1"></i>
                                    Nombre y documento de identidad deben corresponder.
                                </li>
                                <li class="mb-1">
                                    <i class="bi bi-check-circle-fill text-success me-1"></i>
                                    Use el campo <strong>Observaciones</strong> para cualquier nota relevante.
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer de acciones -->
            <div class="card-footer bg-transparent">
                <div class="d-flex flex-wrap justify-content-between align-items-center gap-2">
                    <div class="small text-muted">
                        Los cambios se aplicarán inmediatamente al guardar.
                    </div>
                    <div class="d-flex gap-2">
                        <button id="btn_guardar"
                                class="btn btn-primary btn-sm"
                                type="button"
                                role="button">
                            <i class="bi bi-save me-1"></i>
                            Guardar
                        </button>
                        <a class="btn btn-outline-secondary btn-sm"
                           role="button"
                           th:href="@{/listaPersonal}">
                            <i class="bi bi-arrow-left-short me-1"></i>
                            Volver al listado
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Forefront u otros scripts globales -->
        <th:block th:replace="~{fragments/forefront :: import-forefront}"/>

    </div>
</div>

<script th:inline="javascript">
    /*<![CDATA[*/
    var codigo = /*[[${personal.codigo}]]*/ null;
    /*]]>*/
</script>

</body>
</html>